import{E as s,M,r as o,n as q,$,j as Q,P as E,I as r,T as H,K as L,a3 as P,a4 as f,m as U,a5 as F,a6 as x,a7 as y}from"./index.d048bcd9.js";const A={ratio:[String,Number]};function D(e,i){return s(()=>{const n=Number(e.ratio||(i!==void 0?i.value:void 0));return isNaN(n)!==!0&&n>0?{paddingBottom:`${100/n}%`}:null})}const K=16/9;var W=M({name:"QImg",props:{...A,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:K},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:i,emit:n}){const v=o(e.initialRatio),_=D(e,v);let a;const l=[o(null),o(e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null)],c=o(0),g=o(!1),d=o(!1),T=s(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),w=s(()=>({width:e.width,height:e.height})),z=s(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),N=s(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));q(()=>h(),S);function h(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function S(t){if(clearTimeout(a),d.value=!1,t===null){g.value=!1,l[0].value=null,l[1].value=null;return}g.value=!0,l[c.value].value=t}function R({target:t}){a!==null&&(clearTimeout(a),v.value=t.naturalHeight===0?.5:t.naturalWidth/t.naturalHeight,b(t,1))}function b(t,u){a===null||u===1e3||(t.complete===!0?B(t):a=setTimeout(()=>{b(t,u+1)},50))}function B(t){a!==null&&(c.value=c.value===1?0:1,l[c.value].value=null,g.value=!1,d.value=!1,n("load",t.currentSrc||t.src))}function j(t){clearTimeout(a),g.value=!1,d.value=!0,l[0].value=null,l[1].value=null,n("error",t)}function k(t,u){return r("div",{class:"q-img__container absolute-full",key:t},u)}function C(t){const u=l[t].value,m={key:"img_"+t,class:z.value,style:N.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...u};return c.value===t?(m.class+=" q-img__image--waiting",Object.assign(m,{onLoad:R,onError:j})):m.class+=" q-img__image--loaded",k("img"+t,r("img",m))}function I(){return g.value!==!0?r("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},L(i[d.value===!0?"error":"default"])):r("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},i.loading!==void 0?i.loading():e.noSpinner===!0?void 0:[r(P,{color:e.spinnerColor,size:e.spinnerSize})])}return $.value===!0?Q(()=>{S(h())}):S(h()),E(()=>{clearTimeout(a),a=null}),()=>{const t=[];return _.value!==null&&t.push(r("div",{key:"filler",style:_.value})),d.value!==!0&&(l[0].value!==null&&t.push(C(0)),l[1].value!==null&&t.push(C(1))),t.push(r(H,{name:"q-transition--fade"},I)),r("div",{class:T.value,style:w.value,role:"img","aria-label":e.alt},t)}}});function G(e){{const i={active:!0};if(typeof e=="function"){const n=s(e);i.val=n.value,q(n,v=>{i.val=v,i.active===!0&&f()})}else i.val=e;y.push(i),f(),U(()=>{i.active=!0,f()}),F(()=>{i.active=!1,f()}),x(()=>{y.splice(y.indexOf(i),1),f()})}}export{W as Q,G as u};
